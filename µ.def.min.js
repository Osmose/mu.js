(function(a,b){a.def=function(){var b={},c=this;["pass","fail"].forEach(function(d){b[d]=[],c["on"+d]=function(a){return b[d].push(a),c},c[d]=function(e){if(c.result)return;e=a.arr(arguments),b[d].forEach(function(a){a.apply(!1,e)}),c.result=d}})},a.when=function(){function h(d){return function(h){f=arguments,e[d]=f[b]>1?a.arr(f):h,--g<1&&c.pass.apply(!1,e)}}function i(){c.fail(arguments)}var c=new a.def,d=a.arr(arguments),e=[],f,g=d[b];return setTimeout(function(){var c,e;for(c=0;c<d[b];c++)e=d[c],e instanceof a.def?e.onpass(h(c)).onfail(i):h(c)(e)},0),c}})(Âµ,"length");